# 2025-07-03-错误码设计原则规范化.md

## 问题背景
用户在设计API时发现错误码的使用存在不一致性，需要明确什么时候使用通用错误码（如NOT_FOUND），什么时候使用具体错误码（如USER_NOT_FOUND）。

## 方案思考
根据用户提出的原则：
1. **单一资源场景**：如果API只涉及一种资源且错误类型明确，使用通用错误码
2. **多资源场景**：如果可能出现多种不同的资源不存在情况，使用具体错误码
3. **统一命名规范**：所有错误码使用大写下划线格式

## 代码实现
在开发规范中新增"错误码设计原则"章节，包含：

### 核心原则
- **单一资源** → 通用错误码（NOT_FOUND、UNAUTHORIZED、FORBIDDEN）
- **多资源** → 具体错误码（USER_NOT_FOUND、PROFILE_NOT_FOUND）
- **命名规范** → 大写下划线格式

### 实际示例
```typescript
// 单一资源：获取用户小金库
GET /api/vault → "NOT_FOUND"

// 多资源：创建打卡记录
POST /api/checkin → "USER_NOT_FOUND" 或 "PROFILE_NOT_FOUND"
```

### 错误码分类
1. **通用错误码**：适用于所有模块的基础错误
2. **业务错误码**：特定业务场景的错误
3. **权限错误码**：根据权限复杂度选择通用或具体

## 遇到的问题与解决方案
1. **问题**：缺乏明确的错误码使用标准
   **解决方案**：制定基于资源复杂度的选择原则

2. **问题**：错误码命名不统一
   **解决方案**：统一使用大写下划线格式

## 下次应该注意什么
1. 设计API时先判断资源复杂度
2. 严格遵循错误码命名规范
3. 在开发规范中查找已定义的错误码
4. 新增错误码要符合现有分类体系

## 与用户沟通的经验
- 用户对API设计的一致性要求很高
- 需要将设计原则明确记录到规范中
- 通过具体示例帮助理解抽象原则
- 规范化有助于团队协作和代码维护