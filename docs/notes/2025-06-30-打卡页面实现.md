# 打卡页面实现

## 问题背景
用户需要一个打卡页面，位于 `/checkin/[id]` 路径下，根据打卡配置ID获取对应的问卷进行打卡。

## 方案思考
1. **页面功能**：
   - 根据URL中的ID获取打卡配置
   - 获取关联的问卷内容并展示
   - 支持多种问题类型（单选、多选、填空、评分）
   - 实时计算分数和奖励预览
   - 表单验证和提交打卡

2. **数据流设计**：
   - `GET /api/checkin/profile/{id}` → 获取打卡配置
   - `GET /api/questionnaire/{questionnaireId}` → 获取问卷内容
   - `POST /api/checkin/submit` → 提交打卡答案

3. **用户体验**：
   - 加载状态、错误状态、成功状态的完整处理
   - 实时分数和奖励显示
   - 必填项验证
   - 响应式设计

## 代码实现

### 1. 创建打卡页面 (`src/app/checkin/[id]/page.tsx`)
- 使用 `useParams` 获取路径参数中的ID
- 状态管理：打卡配置、问卷、答案、分数、奖励等
- 支持四种问题类型的渲染和交互
- 实时分数计算和奖励预览
- 完整的错误处理和用户反馈

### 2. 组件依赖
- 使用 shadcn/ui 组件库构建界面
- 安装了缺少的 `checkbox` 组件
- 使用 `sonner` 进行消息提示

### 3. API集成
- 复用现有的 `checkinApi.ts` 和 `questionnaireApi.ts`
- 直接调用 `/api/checkin/submit` 提交打卡
- 遵循现有的错误处理模式

## 特性

### 1. 问题类型支持
- **单选题**：RadioGroup，显示选项分值
- **多选题**：Checkbox，支持多选，显示各选项分值
- **填空题**：Textarea，不计分
- **评分题**：Number Input，限制范围

### 2. 实时反馈
- 答题过程中实时计算当前得分
- 根据奖励规则显示可能获得的奖励
- 必填项验证和错误提示

### 3. 用户体验
- 加载状态：显示 Loading spinner
- 错误状态：显示错误信息和重试按钮
- 成功状态：显示最终得分、奖励和导航按钮
- 响应式设计，适配不同屏幕尺寸

### 4. 页面流程
```
加载打卡配置 → 获取问卷内容 → 用户填写 → 实时分数计算 → 提交打卡 → 显示结果
```

## 技术细节

### 1. 状态管理
使用单一 `CheckinState` 接口管理所有状态，包括：
- 数据状态：profile, questionnaire, answers
- UI状态：loading, submitting, submitted, error
- 计算状态：currentScore, possibleReward, finalScore, finalReward

### 2. 分数计算逻辑
- 单选题：选中选项的分值
- 多选题：所有选中选项分值之和
- 评分题：用户输入的数值
- 填空题：不计分

### 3. 奖励计算逻辑
根据打卡配置中的奖励规则，找到得分达标的最高奖励金额

## 使用方式
1. 用户访问 `/checkin/{profileId}` 
2. 系统自动加载对应的打卡配置和问卷
3. 用户填写问卷，实时查看得分和奖励预览
4. 提交打卡后显示最终结果
5. 可导航到打卡列表或小金库页面